<%# =========================
    PERIODO (solo para mostrar el label)
   ========================= %>
<% last_month = Time.zone.today.last_month %>
<% period_label = l(last_month, format: "%B %Y") %>

<div class="d-flex align-items-center justify-content-between mb-2 mt-3">
  <h5 class="text-light mb-0 d-flex align-items-center">
    <i class="fas fa-trophy text-warning me-2"></i> Top del mes pasado
  </h5>
  <span class="badge rounded-pill text-warning border border-warning bg-transparent">
    <i class="far fa-calendar me-1"></i><%= mes_anio_espanol(period_label.to_date) %>
  </span>
</div>

<div class="note-muted mb-3">
  <i class="far fa-info-circle me-2 text-warning"></i>
  Este ranking usa solo los partidos de <strong><%= mes_anio_espanol(period_label.to_date) %></strong>.
</div>

<% if @top_last_month.present? %>
  <div class="row">
    <% @top_last_month.each do |result| %>
      <% player      = result.player %>
      <% position    = result.position %>
      <% tie         = result.tie %>
      <% wins        = result.victories %>
      <% mvp_count   = result.mvp_count %>
      <% total_games = result.total_matches %>
      <% win_percentage = total_games.positive? ? (100.0 * wins / total_games).round : 0 %>

      <div class="col-md-4 mb-4">
        <%= link_to player_path(player), class: "text-decoration-none text-light" do %>
          <div class="card shadow-sm h-100 border border-warning bg-dark text-light card-gold">
            <div class="card-body d-flex flex-column align-items-center text-center">

              <%# Badges posición + empate, manteniendo tu paleta %>
              <div class="w-100 d-flex justify-content-between mb-2">
                <span class="badge bg-warning text-dark fw-bold">
                  <% if position == 1 %>#1<% elsif position == 2 %>#2<% else %>#3<% end %>
                </span>
                <% if tie %>
                  <span class="chip">
                    <i class="fas fa-equals"></i> empatado
                  </span>
                <% end %>
              </div>

              <%# Foto %>
              <div class="mb-3">
                <% if player.profile_photo.attached? %>
                  <%= image_tag player.profile_photo,
                                class: "rounded-circle border border-3 border-warning",
                                style: "width: 90px; height: 90px; object-fit: cover;" %>
                <% else %>
                  <%= image_tag "default_avatar.png",
                                class: "rounded-circle border border-3 border-warning",
                                width: 90, height: 90 %>
                <% end %>
              </div>

              <%# Título conservando tu estilo %>
              <h6 class="fw-bold text-warning mb-1 d-flex align-items-center">
                <i class="fas fa-star me-2"></i>
                <% if position == 1 && tie %>
                  Empatado en el primer lugar
                <% elsif position == 2 && tie %>
                  Empatado en el segundo lugar
                <% elsif position == 3 && tie %>
                  Empatado en el tercer lugar
                <% else %>
                  <%= position == 1 ? "Jugador del Mes" : "Top #{position}" %>
                <% end %>
              </h6>

              <%# Nombre %>
              <p class="mb-2 text-light fw-semibold"><%= player.full_name %></p>

              <%# Stats (sin recálculos ni queries extra) %>
              <div class="small text-light">
                🏟️ Partidos: <strong><%= total_games %></strong><br>
                🏆 Victorias: <strong><%= wins %></strong><br>
                ✨ MVPs: <strong><%= mvp_count %></strong><br>
                📈 <strong class="text-success"><%= win_percentage %>%</strong> victorias
              </div>

            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="bg-dark text-light border border-secondary rounded p-3 text-center">
    <i class="far fa-inbox me-2"></i>
    No hay datos para <strong><%= period_label %></strong> todavía.
  </div>
<% end %>
