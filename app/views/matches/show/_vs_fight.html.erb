<%# app/views/matches/show/_duelo_fecha.html.erb %>
<% if defined?(@duel_a) && defined?(@duel_b) && @duel_a && @duel_b %>
  <section class="card shadow-sm border border-warning bg-dark text-light rounded-4 mb-4 p-3 p-md-4"
           id="duelo-<%= match.id %>">
    <h4 class="fw-bold text-center text-warning mb-3">
      <i class="fas fa-bolt me-2"></i>Duelo de la Fecha — ¿Quién gana?
    </h4>

    <div class="row g-3 align-items-stretch">
      <!-- Lado A -->
      <div class="col-12 col-lg-5">
        <div class="card h-100 border border-warning bg-dark rounded-3">
          <div class="card-body d-flex gap-3 align-items-center">
            <% if @duel_a.profile_photo.attached? %>
              <%= image_tag @duel_a.profile_photo, class: "rounded-circle border border-warning flex-shrink-0", style: "width:72px;height:72px;object-fit:cover;" %>
            <% else %>
              <%= image_tag "default_avatar.png", class: "rounded-circle border border-warning flex-shrink-0", width: 72, height: 72 %>
            <% end %>

            <div class="flex-grow-1">
              <div class="small text-muted mb-1"><%= match.home_team.name %></div>
              <div class="fw-bold"><%= @duel_a.full_name %></div>

              <div class="mt-3">
                <div class="progress" style="height: 8px;">
                  <div id="duel-bar-a-<%= match.id %>" class="progress-bar"
                       role="progressbar" style="width:<%= @duel_a_pct %>%"
                       aria-valuenow="<%= @duel_a_pct %>" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="d-flex justify-content-between small mt-1">
                  <span id="duel-pct-a-<%= match.id %>"><%= @duel_a_pct %>%</span>
                  <span id="duel-count-a-<%= match.id %>"><%= @duel_total.positive? ? "#{@duel_total} votos" : "Sé el primero en votar" %></span>
                </div>
              </div>
            </div>

            <div class="ms-2">
              <button class="btn btn-outline-warning btn-sm duel-vote-btn"
                      data-match-id="<%= match.id %>"
                      data-player-id="<%= @duel_a.id %>"
                      id="duel-vote-a-<%= match.id %>">
                <%= @your_duel_choice == @duel_a.id ? "Tu voto" : "Votar" %>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- VS -->
      <div class="col-12 col-lg-2 d-flex align-items-center justify-content-center">
        <span class="vs-pill">VS</span>
      </div>

      <!-- Lado B -->
      <div class="col-12 col-lg-5">
        <div class="card h-100 border border-warning bg-dark rounded-3">
          <div class="card-body d-flex gap-3 align-items-center">
            <% if @duel_b.profile_photo.attached? %>
              <%= image_tag @duel_b.profile_photo, class: "rounded-circle border border-warning flex-shrink-0", style: "width:72px;height:72px;object-fit:cover;" %>
            <% else %>
              <%= image_tag "default_avatar.png", class: "rounded-circle border border-warning flex-shrink-0", width: 72, height: 72 %>
            <% end %>

            <div class="flex-grow-1">
              <div class="small text-muted mb-1"><%= match.away_team.name %></div>
              <div class="fw-bold"><%= @duel_b.full_name %></div>

              <div class="mt-3">
                <div class="progress" style="height: 8px;">
                  <div id="duel-bar-b-<%= match.id %>" class="progress-bar"
                       role="progressbar" style="width:<%= @duel_b_pct %>%"
                       aria-valuenow="<%= @duel_b_pct %>" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="d-flex justify-content-between small mt-1">
                  <span id="duel-pct-b-<%= match.id %>"><%= @duel_b_pct %>%</span>
                </div>
              </div>
            </div>

            <div class="ms-2">
              <button class="btn btn-outline-warning btn-sm duel-vote-btn"
                      data-match-id="<%= match.id %>"
                      data-player-id="<%= @duel_b.id %>"
                      id="duel-vote-b-<%= match.id %>">
                <%= @your_duel_choice == @duel_b.id ? "Tu voto" : "Votar" %>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
<% end %>
