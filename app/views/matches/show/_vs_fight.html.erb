<%# Requiere: match, featured_by_team; usa match.home_team / away_team %>
<% home = match.home_team; away = match.away_team %>
<% if home && away && featured_by_team[home.id] && featured_by_team[away.id] %>
  <% a = featured_by_team[home.id]; b = featured_by_team[away.id] %>

  <section class="card shadow-sm border border-warning bg-dark text-light rounded-4 mb-4 p-3 p-md-4">
    <h4 class="fw-bold text-center text-warning mb-3">
      <i class="fas fa-bolt me-2"></i>Duelo de la Fecha
    </h4>

    <div class="row g-3 align-items-stretch">
      <!-- Jugador A -->
      <div class="col-12 col-lg-5">
        <div class="card h-100 border border-warning bg-dark rounded-3">
          <div class="card-body d-flex gap-3 align-items-center">
            <% if a.profile_photo.attached? %>
              <%= image_tag a.profile_photo, class: "rounded-circle border border-warning flex-shrink-0", style: "width:72px;height:72px;object-fit:cover;" %>
            <% else %>
              <%= image_tag "default_avatar.png", class: "rounded-circle border border-warning flex-shrink-0", width: 72, height: 72 %>
            <% end %>

            <div class="flex-grow-1">
              <div class="small text-muted mb-1"><%= home.name %></div>
              <div class="fw-bold"><%= a.full_name %></div>

              <% win_rate_a = a.total_matches.to_i > 0 ? ((a.total_wins.to_f / a.total_matches) * 100).round(1) : nil %>
              <div class="d-flex flex-wrap gap-2 mt-2">
                <% if a.respond_to?(:rating) && a.rating.present? %>
                  <span class="chip"><i class="fas fa-chart-line me-1"></i>Rating <%= a.rating %></span>
                <% end %>
                <% if win_rate_a %>
                  <span class="chip"><i class="fas fa-percentage me-1"></i><%= win_rate_a %>% WR</span>
                <% end %>
                <span class="chip"><i class="fas fa-futbol me-1"></i><%= a.total_matches.to_i %> PJ</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- VS -->
      <div class="col-12 col-lg-2 d-flex align-items-center justify-content-center">
        <span class="vs-pill">VS</span>
      </div>

      <!-- Jugador B -->
      <div class="col-12 col-lg-5">
        <div class="card h-100 border border-warning bg-dark rounded-3">
          <div class="card-body d-flex gap-3 align-items-center">
            <% if b.profile_photo.attached? %>
              <%= image_tag b.profile_photo, class: "rounded-circle border border-warning flex-shrink-0", style: "width:72px;height:72px;object-fit:cover;" %>
            <% else %>
              <%= image_tag "default_avatar.png", class: "rounded-circle border border-warning flex-shrink-0", width: 72, height: 72 %>
            <% end %>

            <div class="flex-grow-1">
              <div class="small text-muted mb-1"><%= away.name %></div>
              <div class="fw-bold"><%= b.full_name %></div>

              <% win_rate_b = b.total_matches.to_i > 0 ? ((b.total_wins.to_f / b.total_matches) * 100).round(1) : nil %>
              <div class="d-flex flex-wrap gap-2 mt-2">
                <% if b.respond_to?(:rating) && b.rating.present? %>
                  <span class="chip"><i class="fas fa-chart-line me-1"></i>Rating <%= b.rating %></span>
                <% end %>
                <% if win_rate_b %>
                  <span class="chip"><i class="fas fa-percentage me-1"></i><%= win_rate_b %>% WR</span>
                <% end %>
                <span class="chip"><i class="fas fa-futbol me-1"></i><%= b.total_matches.to_i %> PJ</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
<% end %>
