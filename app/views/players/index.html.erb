<h1 class="text-center mb-4">
  <i class="fas fa-users me-2"></i>Jugadores <i class="fas fa-users me-2"></i>
</h1>

<div class="d-flex justify-content-end mb-3">
  <%= link_to new_player_path, class: "btn btn-outline-primary shadow-sm" do %>
    <i class="fas fa-user-plus me-2"></i> Nuevo Jugador
  <% end %>
</div>

<div class="table-responsive shadow rounded bg-white">
  <table class="table table-hover table-dark align-middle mb-0">
    <thead class="table-primary text-center">
    <tr>
      <th class="text-start ps-4">Jugador</th>
      <th>Apodo</th>
      <th>Contacto</th>
      <th>Win rate</th>
      <th>Partidos</th>
      <% if user_signed_in? %>
        <th>Acciones</th>
      <% end %>
    </tr>
    </thead>
    <tbody>
    <% @players.each do |player| %>
      <tr>
        <td class="ps-4">
          <div class="d-flex align-items-center">
            <%= image_tag(player.profile_photo.attached? ? player.profile_photo : "default_avatar.png",
                          class: "rounded-circle border me-3",
                          width: 40, height: 40,
                          style: "object-fit: cover;") %>
            <%= link_to player.name, player_path(player),
                        class: "text-decoration-none fw-semibold text-dark" %>
          </div>
        </td>

        <td class="text-center"><%= player.nickname.presence || "—" %></td>

        <td class="text-center">
          <% if player.contact_info.present? %>
            <%= link_to "WhatsApp", "https://wa.me/#{player.contact_info.gsub(/\D/, '')}",
                        target: "_blank",
                        class: "btn btn-sm btn-success",
                        data: { bs_toggle: "tooltip" },
                        title: "Enviar WhatsApp a #{player.name}" %>
          <% else %>
            <span class="text-muted fst-italic">No disponible</span>
          <% end %>
        </td>

        <td class="text-center">
          <% if player.total_matches >= Player::MIN_MATCHES %>
            <div class="small fw-semibold"><%= player.win_rate %>%</div>
            <div class="progress" style="height:8px">
              <div class="progress-bar bg-success" style="width:<%= player.win_rate %>%"></div>>
              <div class="progress-bar bg-danger" style="width:<%= 100 - player.win_rate %>%"></div>
            </div>
          <% else %>
            <span class="text-muted fst-italic">En evaluación</span>
          <% end %>
        </td>

        <td class="text-center"><%= player.participations.count %></td>

        <% if user_signed_in? %>
          <td class="text-center">
            <div class="d-flex justify-content-center gap-2">
              <%= link_to edit_player_path(player),
                          class: "btn btn-warning btn-sm",
                          data: { bs_toggle: "tooltip" },
                          title: "Editar" do %>
                <i class="fas fa-edit"></i>
              <% end %>

              <%= button_to player_path(player), method: :delete,
                            class: "btn btn-danger btn-sm",
                            data: { confirm: "¿Estás seguro?", bs_toggle: "tooltip", title: "Eliminar" } do %>
                <i class="fas fa-trash-alt"></i>
              <% end %>
            </div>
          </td>
        <% end %>
      </tr>
    <% end %>
    </tbody>
  </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(el => new bootstrap.Tooltip(el));
    });
</script>
